# Harmony Environment Variables
# Example .env file.  Rename this file to '.env', move it to the root
# folder, and fill in your project values to make use of it.  Correct
# defaults are provided where possible for local development

###########################################################################
#                             General Config                              #
#                                                                         #
# Settings to control how Harmony behaves                                 #
###########################################################################

# Random string used to sign cookies that should be consistent between
# load-balanced instances of Harmony.  You can use
# `hexdump -n 128 -e '"%08x"' /dev/random`
# to generate a 128 byte random hex string (256 chars)
COOKIE_SECRET=3ecda8c87fb43793d4e5e97500a0ba3b7282d246320a2b813d8fdbe45ded5a9a36de73f2b0d22bde6a172512cc6c64949748fab5f5d9b3eed2138764572be04596089d5ccd47074ed885774e0ef63c94ba9b96043eec46a44f874a226b9d89eb462fb5fdd77e1c5560e0203f61402d87b85c022b481c056d02f63891d4ebebe7
# The port on which to run the Harmony frontend
PORT=3000

# The port on which to run the Harmony backend that receives service
# callbacks
BACKEND_PORT=3001

# The base URL for the service callbacks. This needs to be accessible from
# wherever the service is run. The Harmony CI/CD scripts sets this to the
# backend load balancer when running on AWS. When running locally on a Mac
# or Linux, use the appropriate value below.
# Mac OS X:
# CALLBACK_URL_ROOT=http://host.docker.internal:3001
# Linux:
#CALLBACK_URL_ROOT=http://localhost:3001
CALLBACK_URL_ROOT=http://172.17.0.1:3001
#CALLBACK_URL_ROOT=http://172.17.0.1:3001
# The CMR Endpoint to use (e.g. URL for local, SIT, UAT, or production)
CMR_ENDPOINT=https://cmr.earthdata.nasa.gov

# For testing: Whether to use Localstack instead of AWS S3.  Options are "true" or "false".
USE_LOCALSTACK=true

# If set to true, only include EDL cookies if the request is made via https.
USE_HTTPS=false

# Whether to run example service endpoints under /example.  Useful for
# testing HTTP backends without actual service calls.  See example/http-service.js
EXAMPLE_SERVICES=true

# Identifier so backends know which Harmony client submitted the request
CLIENT_ID=harmony-local

# When set to true log messages are logged as a text string instead of the default
# JSON format. Useful when running harmony locally and viewing logs via a terminal.
TEXT_LOGGER=true

# When set to true log all database queries performed by knex
DEBUG_KNEX=

# Log level (error, warn, info, debug). Defaults to debug.
LOG_LEVEL=

# Number of granules allowed for a synchronous request. When the request exceeds
# this number it will be processed asynchronously. If a service provides a
# value in services.yml for maximum_sync_granules it will override this value.
MAX_SYNCHRONOUS_GRANULES=1

# Number of granules submitted to a backend service within a single request. If a request
# contains more granules, the request will result in multiple calls to the backend service
# with DEFAULT_BATCH_SIZE granules sent in each call. If a service provides a value
# in services.yml for maximum_async_granules it will override this value.
DEFAULT_BATCH_SIZE=2000

# The maximum allowed granules in any request synchronous or asynchronous. If a service
# attempts to configure a value greater than this limit for either maximum_async_granules
# or maximum_async_granules we will override the configuration to limit to this value.
MAX_GRANULE_LIMIT=350

# String to identify the type of environment.  Options:
#  - "development" for local development.
#  - "production" for deployments with a separate postgres server (SIT, UAT, Production).
#  - "test" for unit / integration tests
# This is a conventional identifier to switch application behavior but is
# currently only used to determine which database connection to use in
# db/knexfile.js
NODE_ENV=development

# Connection string to use to connect to the database.  Used for
# NODE_ENV="production" databases.  For development and test, this is
# ignored, using a sqlite3 file instead
DATABASE_URL=

#from prvious version
# add feak AWS account and key to make the local harmony work
AWS_ACCESS_KEY_ID=foo
AWS_SECRET_ACCESS_KEY=bar


# A bucket with brief lifecycle where temporary uploads (shapefiles) are stored while
# requests are in flight
UPLOAD_BUCKET=local-upload-bucket

# An IAM role that allows access to a bucket and prefix where outputs for asynchronous
# requests are stored by backend services.
SAME_REGION_ACCESS_ROLE=same-region-access-role

# The CMR concept ID for the group whose users can access the admin interface
ADMIN_GROUP_ID=AG1222736883-EEDTEST

#from previous version
# The base URL to use for interacting with queues.  The default value is correct for
# localstack.  For SQS, use `https://sqs.REGION.amazonaws.com/YOUR_ACCOUNT_ID/ENV_NAME-`
#BASE_QUEUE_URL=http://10.104.59.113:4566/queue/

# The URL to use for interacting with Argo
#ARGO_URL=http://localhost:2746
ARGO_URL=http://10.110.85.132:2746
LOCALSTACK_HOST=10.96.24.108

# The time (in seconds) between invocations of the job reaper service (default 360)
JOB_REAPER_PERIOD_SEC=

# Jobs older than this many minutes that are running are checked by the job reaper (default 60)
REAPABLE_JOB_AGE_MINUTES=

# The number of seconds before timing out a single step (pod) in an Argo workflow. Defaults
# to 14400 seconds (4 hours).
DEFAULT_ARGO_POD_TIMEOUT_SECS=

#from previous version
# The name of the dead letter queue for message-queue-based services
SERVICE_DEAD_LETTER_QUEUE_NAME=harmony-dead-letter-queue

# The number of ms to wait between polling to check whether a synchronous request completed
SYNC_REQUEST_POLL_INTERVAL_MS=100

# Local development: Use the following to set the Kubernetes context used by start scripts
# (default: docker-desktop).  minikube users should set it to "minikube"
KUBE_CONTEXT=minikube

###########################################################################
#                             Service Config                              #
#                                                                         #
# Variables defined in config/services.yml that get passed to backend     #
# services on invocation                                                  #
###########################################################################

# Docker image:tag names for services referenced in config/services.yml.
# Set to an image:tag available locally, on ECR, on DockerHub, etc.
#
# For Argo services, the image's pull policy variable controls the
# Kubernetes imagePullPolicy used for that service in a given
# environment. See the Kubernetes Container Images documentation for
# the possible imagePullPolicy values and their behavior:
#
#   https://kubernetes.io/docs/concepts/configuration/overview/#container-images
#
# Summary:
#
# Always:       Pulls new image (if available) on each container startup
# IfNotPresent: Pulls new image if it is not available locally
# Never:        Image is assumed to exist locally, it is never pulled
#
# Recommended pull policies by environment:
#
# Environment    Pull Policy    Behavior
# -----------------------------------------------------------------------
# Local          Never          The image:tag will not be pulled and must
#                               exist locally; this can be done by building
#                               the image or pulling it manually.
# Local          IfNotPresent   The image:tag will be pulled if it doesn't
#                               exist locally. If it has been pulled
#                               manually, it will always use that image.
#                               If it is built locally, it will use that
#                               image.
# Sandbox        Always         The image:tag will be pulled each time a
#                               workflow runs which needs the image. Note
#                               that K8S will check the image hash to determine
#                               if an image:tag has been changed, and only
#                               pull it if so.
# SIT            Always         The image:tag is pulled on each workflow run.
# UAT            Always         The image:tag is pulled on each workflow run.
# PROD           IfNotPresent   The image:tag is only pulled if it does not
#                               exist locally.
#
# For Local development, 'IfNotPresent' is recommended since this will use
# the new version of a local image that you are working on locally, while
# pulling any other images not currently under development.

# The image pull policy to use for any images which do not have an explicit
# pull policy configured. See the above table for the recommend value to use
# for the given environment.
DEFAULT_IMAGE_PULL_POLICY='Always'
DEFAULT_PARALLELISM=2

ASF_GDAL_IMAGE=asfdataservices/gdal-subsetter:latest
ASF_GDAL_IMAGE_PULL_POLICY='Never'
ASF_GDAL_PARALLELISM=2

GDAL_IMAGE=harmony/gdal:latest
GDAL_IMAGE_PULL_POLICY='Always'
GDAL_PARALLELISM=2

NETCDF_TO_ZARR_IMAGE=harmony/netcdf-to-zarr:latest
NETCDF_TO_ZARR_IMAGE_PULL_POLICY='Always'
NETCDF_TO_ZARR_PARALLELISM=2

SWOT_REPR_IMAGE=sds/swot-reproject:latest
SWOT_REPR_IMAGE_PULL_POLICY='Always'
SWOT_REPR_PARALLELISM=2

VAR_SUBSETTER_IMAGE=sds/variable-subsetter:latest
VAR_SUBSETTER_IMAGE_PULL_POLICY='Always'
VAR_SUBSETTER_PARALLELISM=2

PODAAC_L2_SUBSETTER_IMAGE=podaac/podaac-cloud/podaac-subsetter:latest
PODAAC_L2_SUBSETTER_IMAGE_PULL_POLICY='Always'
PODAAC_L2_SUBSETTER_PARALLELISM=2

PODAAC_PS3_IMAGE=podaac/podaac-cloud/podaac-shapefile-subsetter:latest
PODAAC_PS3_IMAGE_PULL_POLICY='Always'
PODAAC_PS3_PARALLELISM=2

PODAAC_NETCDF_CONVERTER_IMAGE=podaac/podaac-cloud/podaac-netcdf-converter:latest
PODAAC_NETCDF_CONVERTER_IMAGE_PULL_POLICY='Always'
PODAAC_NETCDF_CONVERTER_PARALLELISM=2

# Prefix before "harmony/task-name" for built-in tasks like query-cmr, e.g. an ECR location
# If not blank, it should end in a slash if there is a slash before "harmony"
BUILT_IN_TASK_PREFIX=
# Version to use for all built-in tasks.  "latest" (local / sandbox), "sit", "uat", or "prod"
BUILT_IN_TASK_VERSION=latest

# The bucket where final service output data will be staged
# Default: A bucket created for use in localstack
STAGING_BUCKET=local-staging-bucket

# The bucket where intermediate service artifacts will be staged
# Default: A bucket created for use in localstack
ARTIFACT_BUCKET=local-artifact-bucket

# Random string used for encrypting and decrypting Earthdata login tokens
# sent to backend services
# `cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1`
# to generate a 32 character random string
SHARED_SECRET_KEY=OPA0VzdectkDArM6aC7ktvI1DNddGBNO

# Development only: hostname to be used to connect to the host OS, used in
# configuring localstack.  Once services fully use docker-compose, we can
# remove this config and just use "localstack"
# Mac OS X:
#BACKEND_HOST=host.docker.internal
# Linux:
#BACKEND_HOST=172.17.0.1
BACKEND_HOST=10.96.24.108
#############################################################################
#                        OAuth 2 (Earthdata Login)                          #
#                                                                           #
# Variables used to configure OAuth 2 authentication for Harmony data users #
#                                                                           #
# To use Earthdata Login, you must first set up a new application using the #
# Earthdata Login UI.                                                       #
# https://wiki.earthdata.nasa.gov/display/EL/How+To+Register+An+Application #
#############################################################################

# Variable            Description                 Example
#--------------------------------------------------------------------------------------
# OAUTH_CLIENT_ID     EDL App Client ID           rCjHBluumLhppiIX5iZxoQ
# OAUTH_UID           EDL App UID                 harmony_kbeam
# OAUTH_PASSWORD      EDL App Password            top_secret
# OAUTH_REDIRECT_URI  Valid EDL App Redirect URL  http://localhost:3000/oauth2/redirect
# OAUTH_HOST          Earthdata Login URL         https://uat.urs.earthdata.nasa.gov

# Notes:
# The OAUTH_REDIRECT_URI needs to be provided verbatim when setting up the
# Earthdata Login app. Each EDL app has a list of valid Redirect URLs, and
# Harmony requires a URI endpoint of "/oauth2/redirect" for all environments.
# When running Harmony locally, for example, add a Redirect URL of
# `http://localhost:3000/oauth2/redirect`. Use HTTPS for non-local instances.
#
# The OAUTH_HOST is used by the Harmony API as well as Harmony services.
# This should be the same EDL environment as used by backend data sources.
# For example, if OAUTH_HOST points to UAT EDL, downloading data from a
# TEA endpoint that's integrated with PROD EDL will fail.

OAUTH_CLIENT_ID=V5GBmUWl0Y5kBrixwq-8NA
OAUTH_UID=your_application_uid
OAUTH_PASSWORD=XXXXXXXXXXXXXXXXXXXXXXXX
OAUTH_REDIRECT_URI=http://localhost:3000/oauth2/redirect
OAUTH_HOST=https://urs.earthdata.nasa.gov

###########################################################################
#                        Fallback Authentication                          #
###########################################################################

# When using data that cannot accept Earthdata Login tokens from
# Harmony, either because of application group setup or because they
# use a different Earthdata Login endpoint (e.g. Data needs production
# while Harmony and CMR need UAT), these provide a
# minimally-privileged EDL user login for fetching remote data behind
# Earthdata Login. This user should exist in all environments being
# used to fetch data.

# CAUTION: This fallback authentication switch should normally be
# disabled.

# CAUTION: This EDL user should *not* have accepted any EDL
# application EULAs. Doing so can result in users getting data for
# which they have not personally accepted the EULA.

# CAUTION: Enabling this could result in skewed metrics since
# downloads will appear to be done by Harmony--not the actual
# end-user--if the fallback authentication is used (e.g., a backend
# data source doesn't yet support EDL federated tokens).

FALLBACK_AUTHN_ENABLED=true
EDL_USERNAME=%{EDL_PASSWORD}%
EDL_PASSWORD='%{EDL_USERNAME}%'

###########################################################################
#                               Test Suite                                #
#                                                                         #
# Settings for altering the behavior of the test suite that are not used  #
# elsewhere in the application.                                           #
###########################################################################

# How to handle fixtures for remote calls in the test suite:
#   record (default): Perform and record new calls.  Replay existing calls.
#   bloody: Perform and record all calls.  Never play back.
#   replay: Always play back.  Throw an error if a call is not recorded.
#   cheat: Play back cached calls.  Perform and do not cache any new calls
REPLAY=record

# True if server logs should be allowed to go to STDOUT.  When false
# (default), they are routed to logs/test.log and suppressed in STDOUT
LOG_STDOUT=false
